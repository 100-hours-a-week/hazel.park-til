## ğŸ—“ï¸ 2025-01-22

### ğŸŒ ìŠ¤í¬ëŸ¼

- í•™ìŠµ ëª©í‘œ 1. K8s Service
- í•™ìŠµ ëª©í‘œ 2. K8s Ingress

### ğŸ’¡ ìƒˆë¡œ ë°°ìš´ ë‚´ìš©

#### 1. K8s Service

podë¥¼ í†µí•´ ì‹¤í–‰ë˜ê³  ìˆëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë„¤íŠ¸ì›Œí¬ì— ë…¸ì¶œ(expose)ì‹œí‚¤ëŠ” ë…¼ë¦¬ì  ì»´í¬ë„ŒíŠ¸

- í•„ìš”í•œ ì´ìœ 

  - podë“¤ì˜ ë°˜ì˜ì†ì ì¸(ephemeral) íŠ¹ì„± ë•Œë¬¸
  - ìƒˆë¡œ ìƒì„±ë  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ë‚´ë¶€ IPë¥¼ í• ë‹¹ë°›ê¸° ë•Œë¬¸ì— í´ëŸ¬ìŠ¤í„° ë‚´/ì™¸ë¶€ì™€ ì§€ì†ì ìœ¼ë¡œ ì•ˆì •ì ì¸ í†µì‹ ì„ ìœ ì§€í•˜ê¸°ê°€ ì–´ë µë‹¤.
  - ì´ëŸ¬í•œ ë¬¸ì œì ì„ í•´ì†Œì‹œí‚¤ê¸° ìœ„í•´ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì— ê³ ì •ì ì¸ IPë¥¼ ê°–ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ë„ë¡ í•œë‹¤.
  - ![image](https://github.com/user-attachments/assets/64f9a3f0-fa7b-4704-896c-71f7f2e3c4dd)

- ì¢…ë¥˜

  - ClusterIP

    - í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ë¡œ ë“¤ì–´ì˜¨ íŠ¸ë˜í”½ì„ í•´ë‹¹í•˜ëŠ” íŒŒë“œì˜ PodIp:targetPort ë¡œ ë„˜ê²¨ì¤Œ

    ```yaml
    # myapp-pod.yaml
    apiVersion: v1
    kind: Pod
    metadata:
      name: myapp-pod
      labels:
        app: myapp
        type: frontend
    spec:
      containers:
        - name: myapp-container
          image: nginx
          ports:
            - containerPort: 9376 # Pod ë‚´ë¶€ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸
    ```

    <br />

    ```yaml
    # myapp-service.yaml
    apiVersion: v1
    kind: Service
    metadata:
      name: myapp-service
    spec:
      type: ClusterIP
      ports:
        - protocol: TCP
          port: 80 # ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œí•˜ëŠ” í¬íŠ¸
          targetPort: 9376 # Pod ë‚´ë¶€ ì• í”Œë¦¬ì¼€ì´ì…˜ í¬íŠ¸
      selector:
        app: myapp # myapp ë¼ë²¨ì´ ìˆëŠ” Podì™€ ì—°ê²°
    ```

    <br />

    - ë§Œì•½ selectorê°€ ì—†ì´ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“ ë‹¤ë©´, ì—”ë“œí¬ì¸íŠ¸ ê°ì²´ë¥¼ ì§ì ‘ ë§Œë“¤ì–´ì„œ ì„œë¹„ìŠ¤ì— ë§¤í•‘í•´ì•¼ í•œë‹¤.

    ```yaml
    # selector ì—†ëŠ” service.yaml
    apiVersion: v1
    kind: Service
    metadata:
      name: my-service # Service ì´ë¦„
    spec:
      ports:
        - port: 80 # Serviceê°€ ë…¸ì¶œí•˜ëŠ” í¬íŠ¸
          targetPort: 8080 # Endpointì˜ í¬íŠ¸ì™€ ë§¤ì¹­
      clusterIP: None # (ì˜µì…˜) Headless Service
    ```

    <br />

    ```yaml
    # endpoints.yaml
    apiVersion: v1
    kind: Endpoints
    metadata:
      name: my-service # Serviceì™€ ë™ì¼í•œ ì´ë¦„
    subsets:
      addresses:
        - ip: 192.168.1.100 # íŠ¸ë˜í”½ì„ ì „ë‹¬í•  ëŒ€ìƒì˜ IP (ìˆ˜ë™ ì„¤ì •)
        - ip: 192.168.1.101 # ì¶”ê°€ Pod ë˜ëŠ” ì™¸ë¶€ ë¦¬ì†ŒìŠ¤
      ports:
        - port: 8080 # ëŒ€ìƒ Podì˜ í¬íŠ¸
    ```

  - NodePort

    - ì™¸ë¶€ì—ì„œ ë…¸ë“œ IPì˜ íŠ¹ì • í¬íŠ¸(NodeIP:NodePort)ë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ê°ì§€í•´ì„œ, í•´ë‹¹ í¬íŠ¸ì™€ ì—°ê²°ëœ íŒŒë“œë¡œ íŠ¸ë˜í”½ì„ ì „ë‹¬í•¨
    - ì´ë•Œ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ë¡œ ë“¤ì–´ì˜¨ íŠ¸ë˜í”½ì„ íŠ¹ì • íŒŒë“œë¡œ ì—°ê²°í•˜ê¸° ìœ„í•œ ClusterIPë„ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤.

    <br />

    ```yaml
    # myapp-service.yaml
    apiVersion: v1
    kind: Service
    metadata:
      name: myapp-service
    spec:
      type: NodePort
      ports:
        - protocol: TCP
          port: 80 # ì„œë¹„ìŠ¤ê°€ ë…¸ì¶œí•˜ëŠ” í¬íŠ¸
          targetPort: 9376 # Pod ë‚´ë¶€ ì• í”Œë¦¬ì¼€ì´ì…˜ í¬íŠ¸
          nodePort: 30007 # ë…¸ë“œì—ì„œ ì™¸ë¶€ë¡œ ë…¸ì¶œë˜ëŠ” í¬íŠ¸ (30000~32767)
      selector:
        app: myapp
    ```

  - LoadBalancer

    - ë³„ë„ì˜ í´ë¼ìš°ë“œ(AWS, Azure, GCP) ë“±ì„ ê³ ë ¤í•˜ì—¬ í´ë¼ìš°ë“œì˜ ë¡œë“œ ë°¸ëŸ°ì„œë¥¼ í´ëŸ¬ìŠ¤í„°ì˜ ì„œë¹„ìŠ¤ë¡œ í”„ë¡œë¹„ì €ë‹ í•  ìˆ˜ ìˆëŠ” ìœ í˜•

    <br />

    ```yaml
    # myapp-service
    apiVersion: v1
    kind: Service
    metadata:
      name: myapp-service
    spec:
      type: LoadBalancer
      ports:
        - protocol: TCP
          port: 80
          targetPort: 9376
      selector:
        app: myapp
    ```

#### 2. K8s Ingress

ë¡œë“œë°¸ëŸ°ì„œ íƒ€ì…ì˜ serviceë¥¼ ì´ìš©í•˜ê²Œ ëœë‹¤ë©´, ì„œë¹„ìŠ¤ 1ê°œë‹¹ ë¡œë“œë°¸ëŸ°ì„œ 1ê°œê°€ í•„ìš”í•¨ â†’ ë¹„ìš© ì¦ê°€

ë”°ë¼ì„œ **í•˜ë‚˜ì˜ IPë¡œ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œí•  ìˆ˜ ì—†ëŠ” LBì˜ í•œê³„ë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ê²ƒ**ì´ Ingressì´ë‹¤.

IngressëŠ” IPê¸°ë°˜ì´ ì•„ë‹ˆë¼ URL ê¸°ë°˜ìœ¼ë¡œ ê²½ë¡œë¥¼ ì°¾ì•„ì¤Œ

ì´ë•Œ **â€œURL ê²½ë¡œ ìš”ì²­ì„ ì–´ë–¤ ì„œë¹„ìŠ¤ë¡œ ì—°ê²°í•´ë¼â€** ë¼ëŠ” **ê·œì¹™**ì„ ì •ì˜í•¨

ì´ëŸ¬í•œ ê·œì¹™ì— ë”°ë¼ ê²½ë¡œë¥¼ ì°¾ëŠ” **í–‰ìœ„**ë¥¼ í•˜ëŠ” ê²ƒì´ **Ingress Controller**

- ì´ì 
  - ë‹¨ì¼ ì§„ì…ì  ì œê³µ
  - ì„œë¹„ìŠ¤ë“¤ë¡œ íŠ¸ë˜í”½ì„ ë¡œë“œ ë°¸ëŸ°ì‹±
  - TLS/HTTPS ì§€ì›

### ğŸ‘ğŸ» ì˜¤ëŠ˜ì˜ íšŒê³ 

- ì„œë¹„ìŠ¤ ê°œë…ì´ ëª¨í˜¸í•´ì„œ ë”¥ë‹¤ì´ë¸Œ ì£¼ì œë¡œ ì„ ì •í–ˆë‹¤. ì²˜ìŒ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ê³µë¶€í•  ë•Œë³´ë‹¤ ìµìˆ™í•œ ë‹¨ì–´ë„ ë§ê³  ì´í•´ë„ ì˜ ë˜ì–´ì„œ ë¿Œë“¯í–ˆë‹¤.

### ğŸ”— ì°¸ê³  ìë£Œ ë° ë§í¬

- [Service reference](https://seongjin.me/kubernetes-service-types/)
- [K8s Dns reference](https://kubernetes.io/blog/2018/07/10/coredns-ga-for-kubernetes-cluster-dns/)
- [Ingress reference](https://gruuuuu.github.io/cloud/k8s-service/)
