## ğŸ—“ï¸ 2024-12-17

### ğŸŒ ìŠ¤í¬ëŸ¼

- í•™ìŠµ ëª©í‘œ 1. AWS Elastic Beanstalk, Docker multi containerë¥¼ ì´ìš©í•˜ì—¬ ë°°í¬í•˜ê¸°

### ğŸ’¡ ìƒˆë¡œ ë°°ìš´ ë‚´ìš©

#### 1. ë°°í¬ ê³¼ì •

EC2 í•œ ëŒ€ì—ì„œ í”„ë¡ íŠ¸, ë°± ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰ì‹œí‚¤ê³  ê²°ë¡ ì ìœ¼ë¡œ ë¸”ë£¨/ê·¸ë¦° ë‘ ëŒ€ì˜ EC2ë¥¼ ë™ì‘ì‹œí‚¤ê³  ì‹¶ì–´ ECS managed Docker platformë¥¼ ì‚¬ìš©í•˜ì˜€ìŒ

1. AWS Elastic Beanstalk

   - AWS EBë¥¼ í†µí•´ ë©€í‹° ì»¨í…Œì´ë„ˆ Dockerë¥¼ ì§€ì›í•˜ëŠ” í™˜ê²½ ì„¤ì •
     - í”Œë«í¼ ë„ì»¤ì˜ ECS ë¸Œëœì¹˜
   - Dockerrun.aws.json v2ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œë¥¼ í•˜ë‚˜ì˜ EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‹¤í–‰

2. Dockerrun.aws.json ì‘ì„±

   ```conf
    {
     "AWSEBDockerrunVersion": "2",
     "containerDefinitions": [
       {
         "name": "frontend",
         "image": "frontend ecr:ë²„ì „",
         "essential": true,
         "memory": 256, # í•„ìˆ˜
         "portMappings": [
           {
             "hostPort": 3000,
             "containerPort": 80
           }
         ]
       },
       {
         "name": "backend",
         "image": "backend ecr:ë²„ì „",
         "essential": true,
         "memory": 512,
         "portMappings": [
           {
             "hostPort": 81,
             "containerPort": 3000
           }
         ]
       }
     ]
   }

   ```

3. NGINX í”„ë¡ì‹œ ì„¤ì •

   - NGINXë¥¼ ì‚¬ìš©í•´ í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ìš”ì²­ì„ í”„ë¡ì‹œë¡œ ì—°ê²°
   - / ê²½ë¡œ â†’ í”„ë¡ íŠ¸ì—”ë“œ
   - /api/ ê²½ë¡œ â†’ ë°±ì—”ë“œ

4. ë§ˆì£¼í–ˆë˜ ìì˜í•œ ì—ëŸ¬ë“¤

   - Creating load balancer failed Reason: Resource handler returned message: "At least two subnets in two different Availability Zones must be specified (Service: ElasticLoadBalancingV2, Status Code: 400, Request ID: e61d0cf5-6c87-42ca-ad74-200b47d2a023)" (RequestToken: 2e10010d-2546-5891-5fdb-e2eaa2ac17f4, HandlerErrorCode: InvalidRequest)
     12ì›” 17, 2024 14:06:54 (UTC+9) **â†’ ì„œë¸Œë„· ë¶€ì¡±**
   - Instance deployment: 'Dockerrun.aws.json' in your source bundle specifies an unsupported version. Elastic Beanstalk only supports version 1 for non compose app and version 3 for compose app. The deployment failed. **â†’ Dockerrun.aws.json ë²„ì „ ì•ˆ ë§ìŒ**
   - ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ MySQL ì—°ë™ ëª»í•¨ â†’ EB í™˜ê²½ë³€ìˆ˜ ì„¤ì •í•˜ê¸°
   - Creating EIP failed Reason: Resource handler returned message: "The maximum number of addresses has been reached. (Service: Ec2, Status Code: 400, Request ID: 50e60476-9b7b-4875-9220-f05fca1c60fd)" (RequestToken: f0ef575b-c7d3-c615-cd05-f9bf69ac8574, HandlerErrorCode: GeneralServiceException)
     12ì›” 17, 2024 17:31:18 (UTC+9) **â†’ í•´ë‹¹ ë¦¬ì „ì˜ EIP í• ë‹¹ í•œë„ ì´ˆê³¼ë¨**
   - Encountered error starting new ECS task: { "tasks": [], "failures": [ { "arn": "arn:aws:ecs:ap-northeast-2:020557303774:container-instance/c62c8b68ea0a447a9595597cde8b8f71", "reason": "RESOURCE:MEMORY" } ] } **â†’ Dockerrun.aws.jsonì— ì»¨í…Œì´ë„ˆì— í• ë‹¹í•  ë©”ëª¨ë¦¬ ê°’ ë„£ê¸°**

### ğŸ‘ğŸ» ì˜¤ëŠ˜ì˜ íšŒê³ 

- ì´ì œ ê¹ƒí—™ ì•¡ì…˜ë§Œ ì—°ê²°í•˜ë©´ ë°°í¬ë¥¼ ëë‚¼ ìˆ˜ ìˆë‹¤. ì–¼ë¥¸ ëë‚´ê³  QA ìˆ˜ì •í•´ì•¼ê² ë‹¤. ì—ëŸ¬ë“¤ì€ ë” ìˆì—ˆë˜ ê±° ê°™ì€ë° ê·¸ë–„ê·¸ë•Œ ì •ë¦¬ë¥¼ ì•ˆ í•´ë†”ì„œ ì´ì œ ëª» ì°¾ê² ë‹¤..

### ğŸ”— ì°¸ê³  ìë£Œ ë° ë§í¬

- [AWS EB, ECS í™œìš© ê³µì‹ ë¬¸ì„œ](https://docs.aws.amazon.com/ko_kr/elasticbeanstalk/latest/dg/create_deploy_docker_ecs.html)
- [The instance profile aws-elasticbeanstalk-ec2-role associated with the environment does not exist.](https://stackoverflow.com/questions/30790666/error-with-not-existing-instance-profile-while-trying-to-get-a-django-project-ru)
- [ Creating Auto Scaling launch configuration failed Reason: Resource handler returned message: "The Launch Configuration creation operation is not available in your account. Use launch templates to create configuration templates for your Auto Scaling groups.](https://hyunco.tistory.com/69)
